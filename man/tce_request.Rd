% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/request.R
\name{tce_request}
\alias{tce_request}
\title{Perform a request to the TCE-PE Open Data API}
\usage{
tce_request(
  endpoint,
  ...,
  clean_names = TRUE,
  max_tries = 3,
  progress = getOption("tceper.progress", TRUE),
  verbose = getOption("tceper.verbose", FALSE)
)
}
\arguments{
\item{endpoint}{A character string with the API method name (e.g.,
\code{"Contratos"}, \code{"DespesasEstaduais"}). See
\url{https://sistemas.tce.pe.gov.br/DadosAbertos/Exemplo!listar} for the
full list of available endpoints.}

\item{...}{Named query parameters passed to the API \strong{exactly as the
API expects them} (typically \code{CamelCase}). \code{NULL} values are silently
dropped. See the API documentation for parameter names.}

\item{clean_names}{If \code{TRUE} (default), column names are converted to
\code{snake_case} via \code{\link[janitor:clean_names]{janitor::clean_names()}}. Set to \code{FALSE} to keep the
original column names returned by the API.}

\item{max_tries}{Maximum number of retry attempts for failed requests
(default: \code{3}). Passed to \code{\link[httr2:req_retry]{httr2::req_retry()}}.}

\item{progress}{If \code{TRUE}, displays progress messages via \link[cli:cli]{cli::cli}. Defaults
to the value of \code{getOption("tceper.progress")}, or \code{TRUE} if unset.}

\item{verbose}{If \code{TRUE}, prints the final API URL to the console before
performing the request. Useful for debugging and testing. Defaults to
\code{getOption("tceper.verbose", FALSE)}.}
}
\value{
A \link[tibble:tibble-package]{tibble} with the response content.
Returns a zero-row tibble if no records are found.
}
\description{
Low-level function that sends a GET request to the TCE-PE Open Data API
and returns the response content as a \link[tibble:tibble-package]{tibble}.
Higher-level wrapper functions such as \code{\link[=tce_contracts]{tce_contracts()}},
\code{\link[=tce_state_expenditures]{tce_state_expenditures()}}, etc. call this function internally.

You can use \code{tce_request()} directly to access any API endpoint,
including those that do not yet have a dedicated wrapper.
}
\details{
\subsection{API base URL}{

\verb{https://sistemas.tce.pe.gov.br/DadosAbertos/}
}

\subsection{URL construction}{

The TCE-PE API uses Struts2-style URLs where \code{!} invokes a method
(e.g. \verb{Contratos!json}). The URL is built with \code{paste0()} to preserve
the literal \code{!} — using \code{httr2::req_url_path_append()} would encode it
as \verb{\%21}, causing the server to ignore all query parameters.
}

\subsection{Response limit}{

The API returns at most \strong{100,000 records} per request. When this limit
is reached, a warning is issued suggesting the use of additional filters.
}

\subsection{Encoding}{

The API responds in ISO-8859-1 encoding, which is converted to UTF-8
internally.
}

\subsection{Options}{
\itemize{
\item \code{tceper.progress} — set to \code{FALSE} to suppress all progress messages.
\item \code{tceper.verbose} — set to \code{TRUE} to always print the final API URL.
\item \code{tceper.cache_ttl} — cache time-to-live in seconds (default: \code{3600}).
}
}
}
\examples{
\dontrun{
# Direct query to any endpoint
tce_request("Contratos", CodigoEfiscoUG = "510101")

# Show the final URL for debugging
tce_request("Contratos", CodigoEfiscoUG = "510101", verbose = TRUE)

# Keep original column names
tce_request("Municipios", clean_names = FALSE)
}
}
